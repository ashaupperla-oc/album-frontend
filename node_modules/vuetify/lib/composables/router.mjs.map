{"version":3,"sources":["../../src/composables/router.tsx"],"names":["getCurrentInstance","propsFactory","computed","onBeforeUnmount","onMounted","resolveDynamicComponent","toRef","useRoute","vm","proxy","$route","useRouter","$router","useLink","props","attrs","RouterLink","isLink","href","to","isClickable","value","onClick","onClickOnce","link","undefined","route","makeRouterProps","String","replace","Boolean","Object","inTransition","useBackButton","cb","router","popped","removeBefore","removeAfter","window","addEventListener","onPopstate","beforeEach","from","next","setTimeout","afterEach","removeEventListener","e","state","replaced"],"mappings":"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","sourcesContent":["// Utilities\nimport { getCurrentInstance, propsFactory } from '@/util'\nimport {\n  computed,\n  onBeforeUnmount,\n  onMounted,\n  resolveDynamicComponent,\n  toRef,\n} from 'vue'\n\n// Types\nimport type { ComputedRef, PropType, Ref, SetupContext } from 'vue'\nimport type {\n  RouterLink as _RouterLink,\n  useLink as _useLink,\n  NavigationGuardNext,\n  RouteLocationNormalizedLoaded,\n  RouteLocationRaw,\n  Router,\n} from 'vue-router'\n\nexport function useRoute (): Ref<RouteLocationNormalizedLoaded | undefined> {\n  const vm = getCurrentInstance('useRoute')\n\n  return computed(() => vm?.proxy?.$route)\n}\n\nexport function useRouter (): Router | undefined {\n  return getCurrentInstance('useRouter')?.proxy?.$router\n}\n\nexport interface LinkProps {\n  href?: string\n  replace?: boolean\n  to?: RouteLocationRaw\n}\n\nexport interface UseLink extends Omit<Partial<ReturnType<typeof _useLink>>, 'href'> {\n  isLink: ComputedRef<boolean>\n  isClickable: ComputedRef<boolean>\n  href: Ref<string | undefined>\n}\n\nexport function useLink (props: LinkProps, attrs: SetupContext['attrs']): UseLink {\n  const RouterLink = resolveDynamicComponent('RouterLink') as typeof _RouterLink | string\n\n  const isLink = computed(() => !!(props.href || props.to))\n  const isClickable = computed(() => {\n    return isLink?.value || !!(attrs.onClick || attrs.onClickOnce)\n  })\n\n  if (typeof RouterLink === 'string') {\n    return {\n      isLink,\n      isClickable,\n      href: toRef(props, 'href'),\n    }\n  }\n\n  const link = props.to ? RouterLink.useLink(props as Required<LinkProps>) : undefined\n\n  return {\n    ...link,\n    isLink,\n    isClickable,\n    href: computed(() => props.to ? link?.route.value.href : props.href),\n  }\n}\n\nexport const makeRouterProps = propsFactory({\n  href: String,\n  replace: Boolean,\n  to: [String, Object] as PropType<RouteLocationRaw>,\n}, 'router')\n\nlet inTransition = false\nexport function useBackButton (cb: (next: NavigationGuardNext) => void) {\n  const router = useRouter()\n  let popped = false\n  let removeBefore: (() => void) | undefined\n  let removeAfter: (() => void) | undefined\n\n  onMounted(() => {\n    window.addEventListener('popstate', onPopstate)\n    removeBefore = router?.beforeEach((to, from, next) => {\n      if (!inTransition) {\n        setTimeout(() => popped ? cb(next) : next())\n      } else {\n        popped ? cb(next) : next()\n      }\n      inTransition = true\n    })\n    removeAfter = router?.afterEach(() => {\n      inTransition = false\n    })\n  })\n  onBeforeUnmount(() => {\n    window.removeEventListener('popstate', onPopstate)\n    removeBefore?.()\n    removeAfter?.()\n  })\n\n  function onPopstate (e: PopStateEvent) {\n    if (e.state?.replaced) return\n\n    popped = true\n    setTimeout(() => (popped = false))\n  }\n}\n"],"file":"router.mjs"}