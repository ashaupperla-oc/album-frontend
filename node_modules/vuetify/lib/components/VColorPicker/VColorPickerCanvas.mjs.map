{"version":3,"sources":["../../../src/components/VColorPicker/VColorPickerCanvas.tsx"],"names":["computed","onMounted","ref","watch","clamp","convertToUnit","defineComponent","getEventCoordinates","VColorPickerCanvas","name","props","color","type","Object","disabled","Boolean","dotSize","Number","String","default","height","width","emits","hue","setup","emit","isInteracting","isOutsideUpdate","dotPosition","x","y","dotStyles","value","radius","parseInt","transform","canvasRef","updateDotPosition","rect","left","top","handleClick","e","clientX","clientY","getBoundingClientRect","handleMouseDown","preventDefault","window","addEventListener","handleMouseMove","handleMouseUp","coords","removeEventListener","h","s","v","a","updateCanvas","canvas","ctx","getContext","saturationGradient","createLinearGradient","addColorStop","fillStyle","fillRect","valueGradient","immediate","deep"],"mappings":"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","sourcesContent":["// Styles\nimport './VColorPickerCanvas.sass'\n\n// Utilities\nimport { computed, onMounted, ref, watch } from 'vue'\nimport { clamp, convertToUnit, defineComponent, getEventCoordinates } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { HSVA } from '@/util'\n\nexport const VColorPickerCanvas = defineComponent({\n  name: 'VColorPickerCanvas',\n\n  props: {\n    color: {\n      type: Object as PropType<HSVA | null>,\n    },\n    disabled: Boolean,\n    dotSize: {\n      type: [Number, String],\n      default: 10,\n    },\n    height: {\n      type: [Number, String],\n      default: 150,\n    },\n    width: {\n      type: [Number, String],\n      default: 300,\n    },\n  },\n\n  emits: {\n    'update:color': (color: HSVA) => true,\n    'update:position': (hue: any) => true,\n  },\n\n  setup (props, { emit }) {\n    const isInteracting = ref(false)\n    const isOutsideUpdate = ref(false)\n    const dotPosition = ref({ x: 0, y: 0 })\n\n    const dotStyles = computed(() => {\n      const { x, y } = dotPosition.value\n      const radius = parseInt(props.dotSize, 10) / 2\n\n      return {\n        width: convertToUnit(props.dotSize),\n        height: convertToUnit(props.dotSize),\n        transform: `translate(${convertToUnit(x - radius)}, ${convertToUnit(y - radius)})`,\n      }\n    })\n\n    const canvasRef = ref<HTMLCanvasElement | null>()\n\n    function updateDotPosition (x: number, y: number, rect: DOMRect) {\n      const { left, top, width, height } = rect\n      dotPosition.value = {\n        x: clamp(x - left, 0, width),\n        y: clamp(y - top, 0, height),\n      }\n    }\n\n    function handleClick (e: MouseEvent) {\n      if (props.disabled || !canvasRef.value) return\n\n      updateDotPosition(e.clientX, e.clientY, canvasRef.value.getBoundingClientRect())\n    }\n\n    function handleMouseDown (e: MouseEvent | TouchEvent) {\n      // To prevent selection while moving cursor\n      e.preventDefault()\n\n      if (props.disabled) return\n\n      isInteracting.value = true\n\n      window.addEventListener('mousemove', handleMouseMove)\n      window.addEventListener('mouseup', handleMouseUp)\n      window.addEventListener('touchmove', handleMouseMove)\n      window.addEventListener('touchend', handleMouseUp)\n    }\n\n    function handleMouseMove (e: MouseEvent | TouchEvent) {\n      if (props.disabled || !canvasRef.value) return\n\n      isInteracting.value = true\n\n      const coords = getEventCoordinates(e)\n\n      updateDotPosition(coords.clientX, coords.clientY, canvasRef.value.getBoundingClientRect())\n    }\n\n    function handleMouseUp () {\n      window.removeEventListener('mousemove', handleMouseMove)\n      window.removeEventListener('mouseup', handleMouseUp)\n      window.removeEventListener('touchmove', handleMouseMove)\n      window.removeEventListener('touchend', handleMouseUp)\n    }\n\n    watch(dotPosition, () => {\n      if (isOutsideUpdate.value) {\n        isOutsideUpdate.value = false\n        return\n      }\n\n      if (!canvasRef.value) return\n\n      const { width, height } = canvasRef.value.getBoundingClientRect()\n      const { x, y } = dotPosition.value\n\n      emit('update:color', {\n        h: props.color?.h ?? 0,\n        s: clamp(x, 0, width) / width,\n        v: 1 - clamp(y, 0, height) / height,\n        a: props.color?.a ?? 1,\n      })\n    })\n\n    function updateCanvas () {\n      if (!canvasRef.value) return\n\n      const canvas = canvasRef.value\n      const ctx = canvas.getContext('2d')\n\n      if (!ctx) return\n\n      const saturationGradient = ctx.createLinearGradient(0, 0, canvas.width, 0)\n      saturationGradient.addColorStop(0, 'hsla(0, 0%, 100%, 1)') // white\n      saturationGradient.addColorStop(1, `hsla(${props.color?.h ?? 0}, 100%, 50%, 1)`)\n      ctx.fillStyle = saturationGradient\n      ctx.fillRect(0, 0, canvas.width, canvas.height)\n\n      const valueGradient = ctx.createLinearGradient(0, 0, 0, canvas.height)\n      valueGradient.addColorStop(0, 'hsla(0, 0%, 100%, 0)') // transparent\n      valueGradient.addColorStop(1, 'hsla(0, 0%, 0%, 1)') // black\n      ctx.fillStyle = valueGradient\n      ctx.fillRect(0, 0, canvas.width, canvas.height)\n    }\n\n    watch(() => props.color?.h, updateCanvas, { immediate: true })\n\n    watch(() => props.color, () => {\n      if (isInteracting.value) {\n        isInteracting.value = false\n        return\n      }\n\n      if (!props.color) return\n\n      isOutsideUpdate.value = true\n\n      dotPosition.value = {\n        x: props.color.s * parseInt(props.width, 10),\n        y: (1 - props.color.v) * parseInt(props.height, 10),\n      }\n    }, { deep: true, immediate: true })\n\n    onMounted(() => updateCanvas())\n\n    return () => (\n      <div\n        class=\"v-color-picker-canvas\"\n        style={{\n          width: convertToUnit(props.width),\n          height: convertToUnit(props.height),\n        }}\n        onClick={ handleClick }\n        onMousedown={ handleMouseDown }\n        onTouchstart={ handleMouseDown }\n      >\n        <canvas\n          ref={ canvasRef }\n          width={ props.width }\n          height={ props.height }\n        />\n        <div\n          class={[\n            'v-color-picker-canvas__dot',\n            {\n              'v-color-picker-canvas__dot--disabled': props.disabled,\n            },\n          ]}\n          style={ dotStyles.value }\n        />\n      </div>\n    )\n  },\n})\n"],"file":"VColorPickerCanvas.mjs"}