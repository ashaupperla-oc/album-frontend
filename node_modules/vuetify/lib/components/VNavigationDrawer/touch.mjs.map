{"version":3,"sources":["../../../src/components/VNavigationDrawer/touch.ts"],"names":["useVelocity","computed","onBeforeUnmount","onMounted","ref","useTouch","isActive","isTemporary","width","touchless","position","window","addEventListener","onTouchstart","passive","onTouchmove","onTouchend","removeEventListener","isHorizontal","value","addMovement","endTouch","getVelocity","maybeDragging","isDragging","dragProgress","offset","start","getOffset","pos","active","document","documentElement","clientWidth","clientHeight","oops","getProgress","limit","progress","Math","max","min","e","touchX","changedTouches","clientX","touchY","clientY","touchZone","inTouchZone","inElement","cancelable","dx","abs","dy","thresholdMet","preventDefault","velocity","identifier","vx","x","vy","y","direction","left","right","bottom","dragStyles","transform","transition","undefined","Error"],"mappings":"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","sourcesContent":["import { useVelocity } from '@/composables/touch'\nimport { computed, onBeforeUnmount, onMounted, ref } from 'vue'\nimport type { Ref } from 'vue'\n\nexport function useTouch ({ isActive, isTemporary, width, touchless, position }: {\n  isActive: Ref<boolean>\n  isTemporary: Ref<boolean>\n  width: Ref<number>\n  touchless: Ref<boolean>\n  position: Ref<'left' | 'right' | 'bottom'>\n}) {\n  onMounted(() => {\n    window.addEventListener('touchstart', onTouchstart, { passive: true })\n    window.addEventListener('touchmove', onTouchmove, { passive: false })\n    window.addEventListener('touchend', onTouchend, { passive: true })\n  })\n\n  onBeforeUnmount(() => {\n    window.removeEventListener('touchstart', onTouchstart)\n    window.removeEventListener('touchmove', onTouchmove)\n    window.removeEventListener('touchend', onTouchend)\n  })\n\n  const isHorizontal = computed(() => position.value !== 'bottom')\n\n  const { addMovement, endTouch, getVelocity } = useVelocity()\n  let maybeDragging = false\n  const isDragging = ref(false)\n  const dragProgress = ref(0)\n  const offset = ref(0)\n  let start: [number, number] | undefined\n\n  function getOffset (pos: number, active: boolean): number {\n    return (\n      position.value === 'left' ? pos\n      : position.value === 'right' ? document.documentElement.clientWidth - pos\n      : position.value === 'bottom' ? document.documentElement.clientHeight - pos\n      : oops()\n    ) - (active ? width.value : 0)\n  }\n\n  function getProgress (pos: number, limit = true): number {\n    const progress = (\n      position.value === 'left' ? (pos - offset.value) / width.value\n      : position.value === 'right' ? (document.documentElement.clientWidth - pos - offset.value) / width.value\n      : position.value === 'bottom' ? (document.documentElement.clientHeight - pos - offset.value) / width.value\n      : oops()\n    )\n    return limit ? Math.max(0, Math.min(1, progress)) : progress\n  }\n\n  function onTouchstart (e: TouchEvent) {\n    if (touchless.value) return\n\n    const touchX = e.changedTouches[0].clientX\n    const touchY = e.changedTouches[0].clientY\n\n    const touchZone = 25\n    const inTouchZone: boolean =\n      position.value === 'left' ? touchX < touchZone\n      : position.value === 'right' ? touchX > document.documentElement.clientWidth - touchZone\n      : position.value === 'bottom' ? touchY > document.documentElement.clientHeight - touchZone\n      : oops()\n\n    const inElement: boolean = isActive.value && (\n      position.value === 'left' ? touchX < width.value\n      : position.value === 'right' ? touchX > document.documentElement.clientWidth - width.value\n      : position.value === 'bottom' ? touchY > document.documentElement.clientHeight - width.value\n      : oops()\n    )\n\n    if (\n      inTouchZone ||\n      inElement ||\n      (isActive.value && isTemporary.value)\n    ) {\n      maybeDragging = true\n      start = [touchX, touchY]\n\n      offset.value = getOffset(isHorizontal.value ? touchX : touchY, isActive.value)\n      dragProgress.value = getProgress(isHorizontal.value ? touchX : touchY)\n\n      endTouch(e)\n      addMovement(e)\n    }\n  }\n\n  function onTouchmove (e: TouchEvent) {\n    const touchX = e.changedTouches[0].clientX\n    const touchY = e.changedTouches[0].clientY\n\n    if (maybeDragging) {\n      if (!e.cancelable) {\n        maybeDragging = false\n        return\n      }\n\n      const dx = Math.abs(touchX - start![0])\n      const dy = Math.abs(touchY - start![1])\n\n      const thresholdMet = isHorizontal.value\n        ? dx > dy && dx > 3\n        : dy > dx && dy > 3\n\n      if (thresholdMet) {\n        isDragging.value = true\n        maybeDragging = false\n      } else if ((isHorizontal.value ? dy : dx) > 3) {\n        maybeDragging = false\n      }\n    }\n\n    if (!isDragging.value) return\n\n    e.preventDefault()\n    addMovement(e)\n\n    const progress = getProgress(isHorizontal.value ? touchX : touchY, false)\n    dragProgress.value = Math.max(0, Math.min(1, progress))\n\n    if (progress > 1) {\n      offset.value = getOffset(isHorizontal.value ? touchX : touchY, true)\n    } else if (progress < 0) {\n      offset.value = getOffset(isHorizontal.value ? touchX : touchY, false)\n    }\n  }\n\n  function onTouchend (e: TouchEvent) {\n    maybeDragging = false\n\n    if (!isDragging.value) return\n\n    addMovement(e)\n\n    isDragging.value = false\n\n    const velocity = getVelocity(e.changedTouches[0].identifier)\n    const vx = Math.abs(velocity.x)\n    const vy = Math.abs(velocity.y)\n    const thresholdMet = isHorizontal.value\n      ? vx > vy && vx > 400\n      : vy > vx && vy > 3\n\n    if (thresholdMet) {\n      isActive.value = velocity.direction === ({\n        left: 'right',\n        right: 'left',\n        bottom: 'up',\n      }[position.value] || oops())\n    } else {\n      isActive.value = dragProgress.value > 0.5\n    }\n  }\n\n  const dragStyles = computed(() => {\n    return isDragging.value ? {\n      transform:\n        position.value === 'left' ? `translateX(calc(-100% + ${dragProgress.value * width.value}px))`\n        : position.value === 'right' ? `translateX(calc(100% - ${dragProgress.value * width.value}px))`\n        : position.value === 'bottom' ? `translateY(calc(100% - ${dragProgress.value * width.value}px))`\n        : oops(),\n      transition: 'none',\n    } : undefined\n  })\n\n  return {\n    isDragging,\n    dragProgress,\n    dragStyles,\n  }\n}\n\nfunction oops (): never {\n  throw new Error()\n}\n"],"file":"touch.mjs"}